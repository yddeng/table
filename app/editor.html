<!doctype html>
<html>
<head>
	<meta charset='utf-8'>
	<title> ExcelEditor</title>
	<script data-jsfiddle="common" src="./jquery.min.js"></script>
	<script src="./handsontable.full.js"></script>
	<script src="./websocket.js"></script>
	<script src="./handsontable.js"></script>
	<script src="./cmd.js"></script>
	<script src="./util.js"></script>

	<link rel="stylesheet" media="screen" href="./css/handsontable.full.css">
	<style>
		.curRow{
			color: red;
		}
	</style>
</head>
<body>
<div style="height: 50px;width: 100%">
	<span id="user"></span><span id="tableName"></span>
	<button onclick="saveTable()">保存</button>
	<span>状态：<i id="status"></i>  </span>
	<span>当前版本：<i id="n_version"></i>  </span><input id="lookv" style="width: 20px"/><button onclick="lookHistory()">查看版本</button>
	<button onclick="backEditor()">回到编辑</button>
	<input id="rbv" style="width: 20px"/><button onclick="rollback()">回退版本</button>
	<button onclick="downExcel()">导出Excel</button> <button onclick="showData()">显示数据</button>
</div>
<div id="table"></div>
<script>

	let tableName = util.getUrlParam("tableName");
	let userName = util.getUrlParam("userName");
	console.log(tableName,userName);
	if (tableName != null && userName!=null){
		socket.init(tableName,userName);

		let user = document.getElementById('user');
		user.innerHTML = util.format(`用户:{0} `,userName);
		let file = document.getElementById('tableName');
		file.innerHTML = util.format(`表名:{0}`,tableName);

		var hot = handstable.init(document.getElementById('table'),tableName)
	}else {
		util.alert("参数错误")
	}

	window.onbeforeunload = function (e) {
		e = e || window.event;
		// 兼容IE8和Firefox 4之前的版本
		if (e) {
			e.returnValue = '关闭提示';
		}
		// Chrome, Safari, Firefox 4+, Opera 12+ , IE 9+
		return '关闭提示';
	};
</script>
</body>
</html>